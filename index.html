<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>ŒºCritter Firmware Pupdate!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="sakura.css" />
    <link rel="stylesheet" href="pupdate-styles.css" />

    <script defer src="dfu.js"></script>
    <script defer src="dfuse.js"></script>
    <script defer src="dfu-util.js"></script>
    <script defer src="app.js"></script>

  </head>

  <body>
    <div class="container">
        <div id="browserNotice" hidden></div>
    </div>

    <header class="hero">
      <h1>ŒºCritter Firmware Pupdate!</h1>
      <p class="tagline">Time to teach your buddy some new tricks! Flash the latest firmware directly from your browser.</p>
    </header>

    <div class="container">

        <div id="readFirstWarning" class="note-box read-first-warning">
             <p><strong>Hold Your Critters!</strong> üê¥ Before clicking Flash, please read <strong>all</strong> instructions for your system below (use the buttons!). Important steps ensure a smooth pupdate for your pal.</p>
        </div>

        <div class="layout-wrapper">

            <div class="column flash-column">
                <section id="flashSection" class="card">
                    <h2>Flash Your Critter</h2>
                    <p style="text-align: center;">Get your Critter into Bootloader mode (Step 1 below!) & follow the prompts here!</p>
                    <p style="text-align: center;">
                        <button id="connect" disabled>Loading Firmware...</button>
                        <span id="status" class="status status-info">Initializing...</span>
                    </p>

                    <dialog id="interfaceDialog">
                       <p>Your device has multiple DFU interfaces. Please select one:</p>
                       <form id="interfaceForm" method="dialog">
                           <div id="interfaceRadioButtons"></div>
                           <button id="selectInterface" type="submit">Use This Interface</button>
                           <button type="button" onclick="this.closest('dialog').close('cancelled')">Cancel</button>
                       </form>
                    </dialog>

                    <div id="usbInfo" style="display: none;"></div>

                    <fieldset>
                        <legend>Pupdate Progress</legend>
                        <div id="dfuseFields" hidden>
                            <label> DfuSe Start Address: <input type="text" id="dfuseStartAddress" size="10" pattern="0x[A-Fa-f0-9]+" placeholder="e.g., 0x08000000"/> </label>
                            <label> DfuSe Upload Size: <input type="number" id="dfuseUploadSize" min="1" placeholder="Bytes" /> </label>
                        </div>
                        <form id="configForm"> <div class="log" id="downloadLog">Waiting for device connection...</div>
                        </form>
                    </fieldset>
                </section>
            </div> <div class="column instructions-column">
                <div class="os-toggle card">
                    <span>Show Instructions For:</span>
                    <div>
                        <button class="os-btn" data-os="mac">macOS</button>
                        <button class="os-btn" data-os="win">Windows</button>
                        <button class="os-btn" data-os="linux">Linux</button>
                        <button class="os-btn" data-os="android">Android</button>
                    </div>
                </div>

                <section id="intro-instructions" class="instructions card">
                    <h2>Step 1: Get Your Critter Ready! (Enter Bootloader Mode)</h2>
                    <div class="note-box" id="dfu-methods-intro">
                        <p><strong>Super Important!</strong> Your ŒºCritter needs to be in its special update mode. Pick <strong>ONE</strong> way to get there. You'll know it worked when the screen shows:</p>
                        <p style="text-align: center; margin-top: 0.5em;"><strong>~CAT BOOTLOADER MODE~</strong><br/><small>Connect to a computer over USB<br/>to download new firmware.</small></p>
                    </div>
                    <ul>
                        <li><strong>Paperclip Poke:</strong> Hold down <kbd>Start</kbd> + <kbd>Select</kbd> + <kbd>Down</kbd>. While holding, gently press the reset button (in the little hole above the speaker) with a paperclip. Release the paperclip first, <em>then</em> the buttons.</li>
                        <li><strong>Sleepy Wake-up:</strong> Is your Critter napping? Hold <kbd>Start</kbd> + <kbd>Select</kbd> + <kbd>Down</kbd>, then press any other button to wake it directly into Bootloader mode!</li>
                        <li><strong>Menu Method:</strong> From the Critter's menu, go to <code>Power</code> ‚Üí <code>Sleep</code>. Let it snooze, then use the "Sleepy Wake-up" method above.</li>
                    </ul>
                    <p><strong>Bootloader screen showing? Awesome!</strong> Now plug your Critter into your computer/phone with its USB cable. On to Step 2!</p>
                     <div class="note-box">
                         <p><strong>Why the refreshes later?</strong> Your Critter uses a super-safe two-stage update process (called MCUBOOT). Your browser talks to both stages, and sometimes needs a page refresh to switch between them. Just follow the messages next to the big Flash button!</p>
                     </div>
                </section>

                <section class="instructions card" data-ins="mac" hidden>
                  <h2>Step 2: macOS Pupdate Dance!</h2>
                  <p>Mac pals, just follow the messages next to the Flash button over there üëà. It's a simple connect-refresh-connect routine!</p>
                  <ol>
                    <li>Make sure your Critter is plugged in and showing the <strong>~CAT BOOTLOADER MODE~</strong> screen (from Step 1!).</li>
                    <li>Click the big <strong>Flash My Critter!</strong> button. (The text might change as you go!)</li>
                    <li>A browser pop-up will ask for permission. Select <code>MCUBOOT</code> and click <strong>Connect</strong>.
                       <div class="note-box">üêæ Seeing <code>CAT PROTOTYPE</code>? Whoops! Your Critter isn't in Bootloader mode. Go back to Step 1 and try again!</div>
                    </li>
                    <li>The status message will tell you when it's time to <strong>REFRESH PAGE</strong>. Do it! (<kbd>‚åò</kbd>+<kbd>R</kbd>)</li>
                    <li>After refreshing, the page might ask you to click the button again (like "Connect Stage 2"). If the pop-up appears, choose <code>MCUBOOT</code> again.</li>
                    <li>The status will again say <strong>REFRESH PAGE AGAIN</strong>. You got this! (<kbd>‚åò</kbd>+<kbd>R</kbd>)</li>
                    <li>One last time! After the final refresh, click the button if needed ("Connect to Flash" perhaps?). The Pupdate should start automatically!</li>
                  </ol>
                   <p><strong>Did it work?</strong> üéâ Keep an eye on the progress log. "Pupdate Complete!" means success! Your Critter will restart with its new tricks.</p>
                </section>

                <section class="instructions card" data-ins="win" hidden>
                  <h2>Step 2: Windows Pupdate Prep! (Drivers Needed!)</h2>
                  <p>Howdy, Windows user! We need to teach Windows how to talk to your Critter in <strong>both</strong> its update stages. This involves a <strong>one-time driver setup</strong> using a tool called Zadig. Please follow carefully!</p>
                  <h3>A. Zadig Driver Setup (Do This TWICE!)</h3>
                  <ol>
                      <li><strong>Fetch Zadig:</strong> Download the latest version from <a href="https://zadig.akeo.ie/" target="_blank" rel="noopener">zadig.akeo.ie</a>.</li>
                      <li><strong>Critter Ready?</strong> Make sure your Critter shows the <strong>~CAT BOOTLOADER MODE~</strong> screen (Step 1!) and is plugged into your PC.</li>
                      <li><strong>Run Zadig as Admin:</strong> Right-click the Zadig file you downloaded and choose "Run as administrator".</li>
                      <li><strong>Show All Devices:</strong> In Zadig, go to the <code>Options</code> menu and check ‚úÖ <code>List All Devices</code>.</li>
                      <li><strong>Install Driver - Stage 1 (<code>MCUBOOT</code> 2FE3:0100):</strong>
                          <ul>
                            <li>Find and select <code>MCUBOOT</code> in the dropdown list (it should have USB ID <code>2FE3</code> / <code>0100</code> next to it).</li>
                            <li>Make sure the box next to the green arrow says <code>WinUSB</code>.</li>
                            <li>Click the big "Replace Driver" or "Install Driver" button. Say yes to any prompts.</li>
                            <li>Close Zadig for now.</li>
                          </ul>
                           <div class="note-box">üêæ Seeing <code>CAT PROTOTYPE</code>? Whoops! Your Critter isn't in Bootloader mode. Go back to Step 1 before using Zadig!</div>
                      </li>
                      <li><strong>First Connection:</strong> Click the <strong>Flash My Critter!</strong> button here on the webpage. Choose <code>MCUBOOT</code> in the browser pop-up and click Connect.</li>
                       <li><strong>Wait for Stage 2:</strong> The page status will say it's switching modes. Windows will detect the "new" device stage. <strong>WAIT 5-10 seconds</strong> for Windows to catch up. <strong>DON'T REFRESH THE PAGE YET!</strong></li>
                       <li><strong>Install Driver - Stage 2 (<code>MCUBOOT</code> 2FE3:FFFF):</strong>
                           <ul>
                            <li>Open Zadig again (as Administrator!). Go to <code>Options</code> -> <code>List All Devices</code> again.</li>
                            <li>Find <code>MCUBOOT</code> again. This time, the USB ID might be <code>2FE3</code> / <code>FFFF</code> (or sometimes it stays <code>0100</code>). Select it.</li>
                            <li>Make sure <code>WinUSB</code> is selected. Click Replace/Install Driver.</li>
                            <li>Close Zadig. You're done with it!</li>
                           </ul>
                       </li>
                       <li><strong>‚ÄºÔ∏è Hardware & Browser Restart (VERY IMPORTANT!) ‚ÄºÔ∏è</strong>
                          <ul>
                              <li>Physically <strong>unplug</strong> the ŒºCritter's USB cable from your PC.</li>
                              <li>Completely <strong>CLOSE your web browser</strong> (all windows and tabs).</li>
                              <li><strong>Re-open</strong> the browser and come back to this page.</li>
                              <li><strong>Plug the ŒºCritter back in</strong> (it should still be in Bootloader mode!).</li>
                          </ul>
                       </li>
                       <li><strong>Almost There!</strong> Now, just follow the status messages next to the Flash button. It might ask you to refresh or connect again.</li>
                  </ol>
                  <h3>B. Windows Pupdate Dance! (After Zadig & Restarts)</h3>
                   <p>Phew! Driver hurdles cleared! Let's finish the Pupdate:</p>
                   <ol start="11"> <li>If prompted, click the button ("Connect Stage 2"?), select <code>MCUBOOT</code> if the pop-up appears.</li>
                     <li>Status message says <strong>REFRESH PAGE AGAIN</strong>? Hit <kbd>Ctrl</kbd>+<kbd>R</kbd> or F5!</li>
                     <li>After the final refresh, click the button if needed ("Connect to Flash"?). The Pupdate starts now!</li>
                   </ol>
                   <p>Watch the progress log. "Pupdate Complete!" = Success! üéâ Your Critter will reboot automatically.</p>
                </section>

                <section class="instructions card" data-ins="linux" hidden>
                  <h2>Step 2: Linux Pupdate Prep! (Permissions Time!)</h2>
                  <p>Hey Linux friend! We need to give your browser permission to chat with the Critter. This is a quick, one-time setup using a <code>udev</code> rule.</p>
                  <h3>A. Create udev Rule (Choose One Method)</h3>
                  <p>You only need to do this once per computer.</p>
                  <h4>Method 1: Manual Steps</h4>
                  <ol>
                    <li><strong>Open your Terminal.</strong></li>
                    <li><strong>Create/Edit the Rules File:</strong> Type or paste: <br/><code>sudo nano /etc/udev/rules.d/51-mcuboot.rules</code></li>
                    <li><strong>Paste These Lines:</strong> Copy the two lines below exactly and paste them into the nano editor:
                      <pre><code class="language-text">SUBSYSTEM=="usb", ATTR{idVendor}=="2fe3", ATTR{idProduct}=="0100", MODE="0666", GROUP="plugdev"
SUBSYSTEM=="usb", ATTR{idVendor}=="2fe3", ATTR{idProduct}=="ffff", MODE="0666", GROUP="plugdev"</code></pre>
                    </li>
                    <li><strong>Save & Exit Nano:</strong> Press <kbd>Ctrl</kbd>+<kbd>X</kbd>, then press <kbd>Y</kbd> to confirm saving, then press <kbd>Enter</kbd>.</li>
                    <li><strong>Check Group & Reload Rules:</strong> Check if you're in the `plugdev` group (see note below). Then, back in the terminal, run: <br/><code>sudo udevadm control --reload-rules && sudo udevadm trigger</code></li>
                  </ol>
                   <h4>Method 2: Bash One-Liner</h4>
                   <p>If you're comfortable with the terminal, this single command does the same thing as the manual steps (creates the file, adds your user to `plugdev` if needed, reloads rules). Copy the whole block and paste it into your terminal:</p>
                   <pre><code class="language-text" style="font-size: 1.1rem;">echo -e 'SUBSYSTEM=="usb", ATTR{idVendor}=="2fe3", ATTR{idProduct}=="0100", MODE="0666", GROUP="plugdev"\nSUBSYSTEM=="usb", ATTR{idVendor}=="2fe3", ATTR{idProduct}=="ffff", MODE="0666", GROUP="plugdev"' | sudo tee /etc/udev/rules.d/51-mcuboot.rules > /dev/null && sudo usermod -aG plugdev $USER && sudo udevadm control --reload-rules && sudo udevadm trigger && echo "Rule created/updated. Log out/in if you weren't in plugdev group before running this."</code></pre>
                   <div class="note-box">
                        <p><small><strong>User Group Check:</strong> The commands above add your user to the `plugdev` group, which is needed on most systems. If this command added you to the group for the first time, you'll need to <strong>log out and log back in</strong> for the change to take effect!</small></p>
                   </div>

                  <h3>B. Linux Pupdate Dance! (After Setup)</h3>
                   <ol start="6"> <li><strong>Re-plug Your Critter:</strong> After setting up the rules (and logging back in if needed), unplug the Critter's USB cable and plug it back in (make sure it's showing the <strong>~CAT BOOTLOADER MODE~</strong> screen!).</li>
                    <li>Click the big <strong>Flash My Critter!</strong> button.</li>
                    <li>If a browser pop-up asks, choose <code>MCUBOOT</code> and click <strong>Connect</strong>.
                       <div class="note-box">üêæ Seeing <code>CAT PROTOTYPE</code>? Whoops! Your Critter isn't in Bootloader mode. Go back to Step 1 and try again!</div>
                    </li>
                    <li>The status message will say <strong>REFRESH PAGE</strong>. Do it! (<kbd>Ctrl</kbd>+<kbd>R</kbd> or F5)</li>
                    <li>After refreshing, click the button again if prompted ("Connect Stage 2"?). Select <code>MCUBOOT</code> if the pop-up shows.</li>
                    <li>Status asks you to <strong>REFRESH PAGE AGAIN</strong>? Go for it! (<kbd>Ctrl</kbd>+<kbd>R</kbd> or F5)</li>
                    <li>Last step! Click the button if needed ("Connect to Flash"?). The Pupdate begins!</li>
                  </ol>
                   <p>Watch the progress log. "Pupdate Complete!" = Success! üéâ Your Critter will reboot with new smarts.</p>
                </section>

                <section class="instructions card" data-ins="android" hidden>
                  <h2>Step 2: Android Pupdate Prep!</h2>
                  <p>Hey Android adventurer! Let's get your phone ready to give your Critter its Pupdate.</p>
                  <div class="note-box"><strong>Browser Requirement:</strong> You MUST use <strong>Google Chrome</strong> on your Android phone! WebUSB usually only works reliably in Chrome.</div>
                  <h3>A. Get Connected & Check OTG</h3>
                  <ol>
                    <li>Make sure your Critter is showing the <strong>~CAT BOOTLOADER MODE~</strong> screen (from Step 1!).</li>
                    <li><strong>Plug Critter into Phone:</strong> You'll need either:
                        <ul>
                            <li>A <strong>USB-C to USB-C cable</strong>.</li>
                            <li><em>OR</em> a <strong>USB OTG adapter</strong> (USB-C for your phone, USB-A for the Critter's cable) + the Critter's normal USB cable.</li>
                        </ul>
                    </li>
                    <li><strong>Enable OTG (If Necessary):</strong>
                        <ul>
                            <li>Many phones turn OTG on automatically!</li>
                            <li>If the Critter isn't detected later, check your phone's <strong>Settings</strong> for "OTG" (sometimes under "Connected Devices" or similar) and flip the switch <strong>ON</strong>.</li>
                            <li>Not sure if your phone supports OTG? Search the Play Store for a "USB OTG Checker" app to find out.</li>
                        </ul>
                    </li>
                  </ol>
                  <h3>B. Android Pupdate Dance!</h3>
                   <p>Ready? Using Chrome, follow the messages next to the Flash button over there üëà:</p>
                  <ol start="4"> <li>Click the big <strong>Flash My Critter!</strong> button.</li>
                    <li>Chrome will pop up asking for permission. Choose <code>MCUBOOT</code> and tap <strong>Connect</strong>.
                       <div class="note-box">üêæ Seeing <code>CAT PROTOTYPE</code>? Whoops! Your Critter isn't in Bootloader mode. Go back to Step 1 and try again!</div>
                    </li>
                    <li>The status message will say <strong>REFRESH PAGE</strong>. In Chrome on Android, you can usually do this by <strong>pulling down from the top of the screen</strong> until you see the refresh icon üîÑ.</li>
                    <li>After refreshing, tap the button again if needed ("Connect Stage 2"?). Select <code>MCUBOOT</code> if the pop-up appears.</li>
                    <li>Status asks to <strong>REFRESH PAGE AGAIN</strong>? You know the drill! (Pull down to refresh!)</li>
                    <li>One last time! Tap the button if needed ("Connect to Flash"?). The Pupdate should start automatically!</li>
                  </ol>
                   <p><strong>Did it work?</strong> üéâ Keep an eye on the progress log. "Pupdate Complete!" means your Critter is ready to reboot and show off!</p>
                </section>

            </div> </div> </div> <footer class="container">
      <p>
        <a href="https://ucritter.com">‚Üê Back to ŒºCritter.com</a> |
        <a href="https://docs.ucritter.com">Critter Docs & Guides</a>
      </p>
      <p><small>Keep your Critter happy with the latest firmware!</small></p>
    </footer>

  </body>
</html>